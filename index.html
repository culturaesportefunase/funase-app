<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistema de Atividades - FUNASE</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema de registro de atividades e convites da FUNASE - Fundação de Atendimento Socioeducativo">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="FUNASE">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- CSS Inline -->
    <style>
        /* ===== RESET E CONFIGURAÇÕES GERAIS ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
        }

        /* ===== LOGIN ===== */
        .login-container {
            padding: 50px;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .login-form {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .login-form h2 {
            color: #1e3a8a;
            margin-bottom: 30px;
            font-size: 2rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #1e3a8a;
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        .login-btn {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .forgot-password-link {
            display: block;
            margin-top: 20px;
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }

        .forgot-password-link:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #dc3545;
            margin-top: 15px;
            font-weight: 500;
            padding: 10px;
            background: #f8d7da;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            color: #155724;
            margin-top: 15px;
            font-weight: 500;
            padding: 10px;
            background: #d4edda;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
        }

        /* ===== CONTEÚDO PRINCIPAL ===== */
        .main-content {
            display: none;
            padding: 30px;
            background: #f8fafc;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .user-welcome {
            color: #1e3a8a;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .logout-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* ===== SEÇÕES DE CONTEÚDO ===== */
        .content-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }

        .content-section h2 {
            color: #1e3a8a;
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
        }

        /* ===== TELA DE BOAS-VINDAS ===== */
        .welcome-container {
            text-align: center;
            padding: 20px;
        }

        .welcome-header h2 {
            color: #1e3a8a;
            font-size: 2.2rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-header p {
            color: #64748b;
            font-size: 1.2rem;
            margin-bottom: 40px;
        }

        .welcome-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .action-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .action-card:hover {
            border-color: #3b82f6;
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.2);
            background: linear-gradient(135deg, #ffffff, #f1f5f9);
        }

        .action-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #3b82f6, #1e3a8a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .action-card h3 {
            color: #1e3a8a;
            font-size: 1.4rem;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .action-card p {
            color: #64748b;
            font-size: 1rem;
            line-height: 1.6;
        }

        /* ===== FORMULÁRIOS ===== */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        /* ===== BOTÕES ===== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
        }

        /* ===== BOTÕES DE AÇÃO PEQUENOS ===== */
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 0 5px;
        }

        .add-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .star-btn {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .star-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
        }

        .star-btn.favorited {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
        }

        /* ===== CAMPOS DINÂMICOS ===== */
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-row input {
            flex: 1;
        }

        .button-group {
            display: flex;
            gap: 5px;
        }

        /* ===== UPLOAD DE FOTOS ===== */
        .photo-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .photo-upload-btn {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8fafc;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .photo-upload-btn:hover {
            border-color: #3b82f6;
            background: #f1f5f9;
        }

        .photo-preview {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .photo-preview img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .photo-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
        }

        /* ===== UNIDADES GRID ===== */
        .unidades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .unidade-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .unidade-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        /* ===== DASHBOARD ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

            .section-header {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 30px;
            }

            .back-btn {
                background: linear-gradient(135deg, #64748b, #94a3b8);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(100, 116, 139, 0.2);
                display: flex;
                align-items: center;
                gap: 5px;
            }

            .back-btn:hover {
                background: linear-gradient(135deg, #475569, #64748b);
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
            }

            .section-header h2 {
                margin: 0;
                color: #1e3a8a;
                font-size: 1.8rem;
                font-weight: 700;
            }

            .unit-input-container {
                display: flex;
                gap: 10px;
                align-items: center;
            }

            .unit-input-container select {
                flex: 1;
            }

            .add-unit-btn {
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 8px;
                font-size: 20px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .add-unit-btn:hover {
                background: linear-gradient(135deg, #218838, #1e7e34);
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            }

            .modal {
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .modal-content {
                background: white;
                border-radius: 15px;
                padding: 0;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            }

            .modal-header {
                background: linear-gradient(135deg, #1e3a8a, #3b82f6);
                color: white;
                padding: 20px;
                border-radius: 15px 15px 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .modal-header h3 {
                margin: 0;
                font-size: 1.5rem;
            }

            .close-btn {
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                transition: background-color 0.3s ease;
            }

            .close-btn:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .modal-body {
                padding: 20px;
            }

            .metric-card {
                background: white;
                padding: 25px;
                border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .metric-label {
            color: #64748b;
            font-size: 1rem;
            font-weight: 500;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .chart-title {
            color: #1e3a8a;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        /* ===== DROPDOWN PERSONALIZADO ===== */
        .custom-dropdown {
            position: relative;
            width: 100%;
        }

        .dropdown-selected {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .dropdown-option {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dropdown-option:hover {
            background: #f1f5f9;
        }

        .dropdown-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        /* ===== HISTÓRICO E TABELAS ===== */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8fafc;
        }

        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .login-form,
            .main-content,
            .content-section {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .welcome-actions {
                grid-template-columns: 1fr;
            }

            .action-card {
                padding: 20px 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .photo-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🏛️ FUNASE</h1>
            <p>Sistema de Atividades - Cultura, Lazer e Esportes</p>
        </div>

        <!-- Login Container -->
        <div id="loginContainer" class="login-container">
            <div class="login-form">
                <h2>🔐 Acesso ao Sistema</h2>
                <div class="form-group">
                    <label for="email">E-mail Institucional</label>
                    <input type="email" id="email" placeholder="seu.email@funase.pe.gov.br" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">Lembrar-me</label>
                </div>
                <button type="button" class="login-btn" onclick="handleLogin()">Entrar no Sistema</button>
                <a href="#" class="forgot-password-link" onclick="forgotPassword()">Esqueci minha senha</a>
                <div id="loginError" class="error-message" style="display: none;"></div>
                <div id="loginSuccess" class="success-message" style="display: none;"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="main-content" style="display: none;">
            <!-- User Info -->
            <div class="user-info">
                <div class="user-welcome">
                    <span id="userWelcome">Bem-vindo!</span>
                </div>
                <button class="logout-btn" onclick="handleLogout()">Sair</button>
            </div>

            <!-- Main Cards Section -->
            <div id="mainCards" class="content-section" style="display: block;">
                <div class="welcome-container">
                    <div class="welcome-header">
                        <h2>Bem-vindo ao Sistema FUNASE</h2>
                        <p>Gerencie atividades, convites e relatórios de forma eficiente</p>
                    </div>
                    
                    <div class="welcome-actions">
                        <div class="action-card" onclick="showSection('form')">
                            <div class="action-icon">📝</div>
                            <h3>Registrar Atividade</h3>
                            <p>Cadastre atividades culturais, esportivas e de lazer com fotos e participantes</p>
                        </div>
                        
                        <div class="action-card" onclick="showSection('convites')">
                            <div class="action-icon">🎫</div>
                            <h3>Cadastrar Convite</h3>
                            <p>Crie convites para eventos e gerencie inscrições das unidades</p>
                        </div>
                        
                        <div class="action-card" onclick="showSection('historico')">
                            <div class="action-icon">📋</div>
                            <h3>Histórico de Atividades</h3>
                            <p>Consulte, edite e adicione relatórios às atividades realizadas</p>
                        </div>
                        
                        <div class="action-card" onclick="showSection('consulta')">
                            <div class="action-icon">🔍</div>
                            <h3>Consulta Individual</h3>
                            <p>Busque histórico completo de atividades por jovem para audiências</p>
                        </div>
                        
                        <div class="action-card" onclick="showSection('dashboard')">
                            <div class="action-icon">📊</div>
                            <h3>Dashboard</h3>
                            <p>Visualize estatísticas e relatórios das atividades realizadas</p>
                        </div>
                        
                        <div class="action-card" onclick="showSection('usuarios')">
                            <div class="action-icon">👥</div>
                            <h3>Cadastrar Usuários</h3>
                            <p>Gerencie usuários e contatos para notificações</p>
                        </div>
                        
                        <div class="action-card" onclick="showSection('backup')">
                            <div class="action-icon">🛡️</div>
                            <h3>Backup</h3>
                            <p>Faça backup dos dados e mantenha informações seguras</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Section -->
            <div id="formSection" class="content-section">
                <div class="section-header">
                    <button class="back-btn" onclick="showMainContent()">← Voltar</button>
                    <h2>📝 Registrar Atividade</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="numeroAtividade">Número da Atividade</label>
                        <input type="text" id="numeroAtividade" placeholder="Gerado automaticamente..." readonly style="background-color: #f8fafc; color: #64748b;">
                    </div>
                    <div class="form-group">
                        <label for="activityName">Nome da Atividade</label>
                        <input type="text" id="activityName" placeholder="Digite o nome da atividade" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="activityDate">Data da Atividade</label>
                        <input type="date" id="activityDate" required>
                    </div>
                    <div class="form-group">
                        <label for="activityTime">Horário</label>
                        <input type="time" id="activityTime" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="activityLocation">Local</label>
                        <input type="text" id="activityLocation" placeholder="Local onde foi realizada a atividade" required>
                    </div>
                    <div class="form-group">
                        <label for="activityTypeSelect">Tipo de Atividade</label>
                        <select id="activityTypeSelect">
                            <option value="interna">Interna</option>
                            <option value="externa">Externa</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="activityDescription">Descrição da Atividade</label>
                    <textarea id="activityDescription" placeholder="Descreva a atividade realizada..." required></textarea>
                </div>

                <!-- Quem Promoveu -->
                <div class="form-group">
                    <label>Quem Promoveu</label>
                    <div id="promoterContainer">
                        <div class="promoter-input">
                            <div class="input-row">
                                <input type="text" placeholder="Nome de quem promoveu a atividade">
                                <div class="button-group">
                                    <button type="button" class="action-btn add-btn" onclick="addPromoter()" title="Adicionar promotor">+</button>
                                    <button type="button" class="action-btn star-btn" onclick="favoritePromoter(this)" title="Favoritar">⭐</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Jovens Participantes -->
                <div class="form-group">
                    <label>Jovens Participantes</label>
                    <div id="participantsContainer">
                        <div class="participant-input">
                            <div class="input-row">
                                <input type="text" placeholder="Nome do jovem participante">
                                <div class="button-group">
                                    <button type="button" class="action-btn add-btn" onclick="addParticipant()" title="Adicionar participante">+</button>
                                    <button type="button" class="action-btn star-btn" onclick="favoriteParticipant(this)" title="Favoritar">⭐</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equipe Participante -->
                <div class="form-group">
                    <label>Equipe Participante</label>
                    <div id="teamContainer">
                        <div class="team-member">
                            <div class="input-row">
                                <input type="text" placeholder="Nome do membro da equipe">
                                <input type="text" placeholder="Função/Cargo">
                                <div class="button-group">
                                    <button type="button" class="action-btn add-btn" onclick="addTeamMember()" title="Adicionar membro">+</button>
                                    <button type="button" class="action-btn star-btn" onclick="favoriteTeamMember(this)" title="Favoritar">⭐</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fotos da Atividade -->
                <div class="form-group">
                    <label>Fotos da Atividade (até 10 fotos)</label>
                    <input type="file" id="photoInput" accept="image/*" multiple style="display: none;" onchange="handlePhotoUpload(event)">
                    <div id="photoContainer" class="photo-container">
                        <div class="photo-upload-btn" onclick="document.getElementById('photoInput').click()">
                            <span style="font-size: 2rem;">📷</span>
                            <span>Adicionar Fotos</span>
                        </div>
                    </div>
                    <div id="photoCount" style="margin-top: 10px; color: #64748b;">0/10 fotos</div>
                </div>

                <!-- Botões de Ação -->
                <div style="margin-top: 30px; text-align: center;">
                    <button type="button" class="btn btn-success" onclick="saveActivity()">💾 Salvar Atividade</button>
                    <button type="button" class="btn btn-warning" onclick="duplicateActivity()">📋 Duplicar Atividade</button>
                    <button type="button" class="btn btn-info" onclick="addReport()">📝 Acrescentar Relatório</button>
                    <button type="button" class="btn btn-primary" onclick="newActivity()">➕ Acrescentar Atividade</button>
                </div>
            </div>

            <!-- Histórico Section -->
            <div id="historicoSection" class="content-section">
                <div class="section-header">
                    <button class="back-btn" onclick="showMainContent()">← Voltar</button>
                    <h2>📋 Histórico de Atividades</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="searchActivity">Buscar Atividade</label>
                        <input type="text" id="searchActivity" placeholder="Busque por número, nome, data ou unidade...">
                    </div>
                    <div class="form-group">
                        <label for="filterPeriod">Filtrar por Período</label>
                        <select id="filterPeriod">
                            <option value="all">Todos os períodos</option>
                            <option value="today">Hoje</option>
                            <option value="week">Esta semana</option>
                            <option value="month">Este mês</option>
                            <option value="year">Este ano</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table id="activityHistoryTable">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Nome da Atividade</th>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Participantes</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; color: #64748b;">Nenhuma atividade registrada ainda</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Consulta Individual Section -->
            <div id="consultaSection" class="content-section">
                <div class="section-header">
                    <button class="back-btn" onclick="showMainContent()">← Voltar</button>
                    <h2>🔍 Consulta Individual de Jovens</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="searchYouth">Nome do Jovem</label>
                        <input type="text" id="searchYouth" placeholder="Digite o nome do jovem para consultar histórico...">
                    </div>
                    <div class="form-group">
                        <label for="searchUnit">Unidade</label>
                        <select id="searchUnit">
                            <option value="">Todas as unidades</option>
                            <option value="Case Santa Luzia">Case Santa Luzia</option>
                            <option value="Case Jaboatão dos Guararapes">Case Jaboatão dos Guararapes</option>
                            <option value="Case Muribeca">Case Muribeca</option>
                            <option value="Case Pirapama">Case Pirapama</option>
                            <option value="Case Timbaúba">Case Timbaúba</option>
                            <option value="Case Vitória de Santo Antão (Pacas)">Case Vitória de Santo Antão (Pacas)</option>
                            <option value="Case Caruaru">Case Caruaru</option>
                            <option value="Case Garanhuns">Case Garanhuns</option>
                            <option value="Case Arcoverde">Case Arcoverde</option>
                            <option value="Case Petrolina">Case Petrolina</option>
                            <option value="Casem Petrolina">Casem Petrolina</option>
                            <option value="Casem Santa Luzia">Casem Santa Luzia</option>
                            <option value="Casem Harmonia">Casem Harmonia</option>
                            <option value="Casem Areias">Casem Areias</option>
                            <option value="Casem Iputinga">Casem Iputinga</option>
                            <option value="Casem Caruaru">Casem Caruaru</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: 20px 0;">
                    <button type="button" class="btn btn-primary" onclick="searchYouthHistory()">🔍 Buscar Histórico</button>
                    <button type="button" class="btn btn-success" onclick="generateYouthReport()" id="generateReportBtn" style="display: none;">📄 Gerar Relatório</button>
                    <button type="button" class="btn btn-warning" onclick="manageCertificates()" id="manageCertBtn" style="display: none;">🏆 Gerenciar Certificados</button>
                </div>

                <div id="youthHistoryResult" style="display: none;">
                    <div class="metric-card">
                        <h3 id="youthName" style="color: #1e3a8a; margin-bottom: 15px;"></h3>
                        <div class="dashboard-grid">
                            <div class="metric-card">
                                <div class="metric-value" id="totalActivities">0</div>
                                <div class="metric-label">Total de Atividades</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="participationFrequency">0%</div>
                                <div class="metric-label">Frequência de Participação</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="youthActivitiesTable">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Atividade</th>
                                    <th>Tipo</th>
                                    <th>Local</th>
                                    <th>Unidade</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button type="button" class="btn btn-success" onclick="exportYouthReport()">📄 Exportar Relatório PDF</button>
                    </div>
                </div>

                <!-- Modal de Certificados -->
                <div id="certificatesModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>🏆 Gerenciar Certificados</h3>
                            <button class="close-btn" onclick="closeCertificatesModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="certificateActivity">Selecionar Atividade</label>
                                <select id="certificateActivity">
                                    <option value="">Selecione uma atividade...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="certificateFile">Upload do Certificado</label>
                                <input type="file" id="certificateFile" accept="image/*,.pdf" onchange="previewCertificate(event)">
                                <div id="certificatePreview" style="margin-top: 10px;"></div>
                            </div>
                            <div class="form-group">
                                <label for="certificateNotes">Observações (opcional)</label>
                                <textarea id="certificateNotes" placeholder="Observações sobre o certificado..."></textarea>
                            </div>
                            <div style="text-align: center; margin-top: 20px;">
                                <button type="button" class="btn btn-success" onclick="saveCertificate()">💾 Salvar Certificado</button>
                                <button type="button" class="btn btn-secondary" onclick="closeCertificatesModal()">❌ Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Convites Section -->
            <div id="conviteSection" class="content-section">
                <div class="section-header">
                    <button class="back-btn" onclick="showMainContent()">← Voltar</button>
                    <h2>🎫 Cadastrar Convite</h2>
                </div>>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventName">Nome do Evento</label>
                        <div class="input-row">
                            <input type="text" id="eventName" placeholder="Nome do evento ou atividade" required>
                            <button type="button" class="action-btn star-btn" onclick="favoriteEventName(this)" title="Favoritar evento">⭐</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="eventDate">Data do Evento</label>
                        <input type="date" id="eventDate" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventTime">Horário</label>
                        <input type="time" id="eventTime" required>
                    </div>
                    <div class="form-group">
                        <label for="eventVacancies">Número de Vagas</label>
                        <input type="number" id="eventVacancies" placeholder="Quantidade de vagas" min="1" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="eventLocation">Local do Evento</label>
                    <div class="input-row">
                        <input type="text" id="eventLocation" placeholder="Local onde será realizado" required>
                        <button type="button" class="action-btn star-btn" onclick="favoriteEventLocation(this)" title="Favoritar local">⭐</button>
                        <button type="button" class="action-btn add-btn" onclick="addLocationLink()" title="Adicionar link de localização">🗺️</button>
                    </div>
                    <input type="url" id="locationLink" placeholder="Link do Google Maps (opcional)" style="margin-top: 10px;">
                </div>

                <div class="form-group">
                    <label for="eventDescription">Descrição do Evento</label>
                    <textarea id="eventDescription" placeholder="Descreva o evento, atividades, requisitos..." required></textarea>
                </div>

                <!-- Upload de Imagem do Convite -->
                <div class="form-group">
                    <label>Imagem do Convite/Local</label>
                    <input type="file" id="conviteImageInput" accept="image/*" style="display: none;" onchange="handleConviteImageUpload(event)">
                    <div id="conviteImageContainer" class="photo-container">
                        <div class="photo-upload-btn" onclick="document.getElementById('conviteImageInput').click()">
                            <span style="font-size: 2rem;">🖼️</span>
                            <span>Adicionar Imagem</span>
                        </div>
                    </div>
                </div>

                <!-- Unidades que podem participar -->
                <div class="form-group">
                    <label>Unidades que podem participar</label>
                    <div class="custom-dropdown">
                        <div class="dropdown-selected" onclick="toggleUnitsDropdown()">
                            <span id="selectedUnitsText">Selecione as unidades...</span>
                            <span>▼</span>
                        </div>
                        <div id="unitsDropdown" class="dropdown-options">
                            <div class="dropdown-option">
                                <input type="checkbox" id="todas-unidades" onchange="toggleAllUnits(this)">
                                <label for="todas-unidades">Todas as unidades</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Santa Luzia" onchange="updateSelectedUnits()">
                                <label>Case Santa Luzia</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Jaboatão dos Guararapes" onchange="updateSelectedUnits()">
                                <label>Case Jaboatão dos Guararapes</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Muribeca" onchange="updateSelectedUnits()">
                                <label>Case Muribeca</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Pirapama" onchange="updateSelectedUnits()">
                                <label>Case Pirapama</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Timbaúba" onchange="updateSelectedUnits()">
                                <label>Case Timbaúba</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Vitória de Santo Antão (Pacas)" onchange="updateSelectedUnits()">
                                <label>Case Vitória de Santo Antão (Pacas)</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Caruaru" onchange="updateSelectedUnits()">
                                <label>Case Caruaru</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Garanhuns" onchange="updateSelectedUnits()">
                                <label>Case Garanhuns</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Arcoverde" onchange="updateSelectedUnits()">
                                <label>Case Arcoverde</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Case Petrolina" onchange="updateSelectedUnits()">
                                <label>Case Petrolina</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Casem Petrolina" onchange="updateSelectedUnits()">
                                <label>Casem Petrolina</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Casem Santa Luzia" onchange="updateSelectedUnits()">
                                <label>Casem Santa Luzia</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Casem Harmonia" onchange="updateSelectedUnits()">
                                <label>Casem Harmonia</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Casem Areias" onchange="updateSelectedUnits()">
                                <label>Casem Areias</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Casem Iputinga" onchange="updateSelectedUnits()">
                                <label>Casem Iputinga</label>
                            </div>
                            <div class="dropdown-option">
                                <input type="checkbox" name="unidade" value="Casem Caruaru" onchange="updateSelectedUnits()">
                                <label>Casem Caruaru</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div style="margin-top: 30px; text-align: center;">
                    <button type="button" class="btn btn-success" onclick="saveInvite()">💾 Salvar Convite</button>
                    <button type="button" class="btn btn-primary" onclick="publishInvite()">📢 Publicar Convite</button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section">
                <div class="section-header">
                    <button class="back-btn" onclick="showMainContent()">← Voltar</button>
                    <h2>📊 Dashboard</h2>
                </div>
                
                <!-- Filtro de Período -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="dashboardPeriod">Período de Análise</label>
                        <select id="dashboardPeriod" onchange="updateDashboard()">
                            <option value="today">Hoje</option>
                            <option value="week">Esta semana</option>
                            <option value="month" selected>Este mês</option>
                            <option value="quarter">Este trimestre</option>
                            <option value="year">Este ano</option>
                            <option value="custom">Período personalizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="button" class="btn btn-info" onclick="showPopulationData()">⚙️ Configurar Dados Populacionais</button>
                    </div>
                </div>

                <!-- Métricas Principais -->
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="totalActivities">0</div>
                        <div class="metric-label">Atividades Registradas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalInvites">0</div>
                        <div class="metric-label">Convites Publicados</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="acceptedInvites">0</div>
                        <div class="metric-label">Convites Aceitos/Realizados</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="conversionRate">0%</div>
                        <div class="metric-label">Taxa de Conversão</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalParticipations">0</div>
                        <div class="metric-label">Participações Totais</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="uniqueYouths">0</div>
                        <div class="metric-label">Jovens Únicos</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="participationPercentage">0.0%</div>
                        <div class="metric-label">% de Participação (base FUNASE)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="averageParticipation">0.0</div>
                        <div class="metric-label">Média de Participações por Jovem</div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="chart-container">
                    <div class="chart-title">📊 Comparativo por Unidade - Atividades vs Jovens Enviados</div>
                    <div id="unitsChart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                        Gráfico será exibido aqui com dados das atividades registradas
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">📈 Análise de Convites - Publicados vs Aceitos</div>
                    <div id="invitesChart" style="height: 250px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                        Gráfico de barras comparativo será exibido aqui
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">👥 Quantidade Nominal de Jovens por Unidade</div>
                    <div id="youthsByUnit" style="min-height: 200px;">
                        <div style="text-align: center; color: #64748b; padding: 50px;">
                            Lista nominal de participantes por unidade será exibida aqui
                        </div>
                    </div>
                </div>

                <!-- Seção de Dados Populacionais (inicialmente oculta) -->
                <div id="populationDataSection" class="chart-container" style="display: none;">
                    <div class="chart-title">📊 Configurar Dados Populacionais FUNASE</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="populationDate">Data</label>
                            <input type="date" id="populationDate" required>
                        </div>
                        <div class="form-group">
                            <label for="totalYouths">Total de Jovens FUNASE</label>
                            <input type="number" id="totalYouths" placeholder="Ex: 400" min="1" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="populationNotes">Observações (opcional)</label>
                        <textarea id="populationNotes" placeholder="Observações sobre os dados populacionais..."></textarea>
                    </div>

                    <div style="text-align: center; margin: 20px 0;">
                        <button type="button" class="btn btn-success" onclick="savePopulationData()">💾 Salvar Dados</button>
                        <button type="button" class="btn btn-warning" onclick="exportPopulationData()">📊 Exportar Histórico</button>
                        <button type="button" class="btn btn-danger" onclick="hidePopulationData()">❌ Fechar</button>
                    </div>

                    <div class="table-container">
                        <table id="populationHistoryTable">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Total de Jovens</th>
                                    <th>Observações</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" style="text-align: center; color: #64748b;">Nenhum dado populacional registrado ainda</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Usuários Section -->
            <div id="usuariosSection" class="content-section">
                <div class="section-header">
                    <button class="back-btn" onclick="showMainContent()">← Voltar</button>
                    <h2>👥 Cadastrar Usuários</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="userName">Nome do Usuário</label>
                        <input type="text" id="userName" placeholder="Nome completo" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">E-mail do Usuário</label>
                        <input type="email" id="userEmail" placeholder="usuario@funase.pe.gov.br" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="userWhatsapp">WhatsApp</label>
                        <input type="tel" id="userWhatsapp" placeholder="(81) 99999-9999" required>
                    </div>
                    <div class="form-group">
                        <label for="userUnit">Unidade</label>
                        <div class="unit-input-container">
                            <select id="userUnit" required>
                                <option value="">Selecione a unidade</option>
                                <option value="Case Santa Luzia">Case Santa Luzia</option>
                                <option value="Case Jaboatão dos Guararapes">Case Jaboatão dos Guararapes</option>
                                <option value="Case Muribeca">Case Muribeca</option>
                                <option value="Case Pirapama">Case Pirapama</option>
                                <option value="Case Timbaúba">Case Timbaúba</option>
                                <option value="Case Vitória de Santo Antão (Pacas)">Case Vitória de Santo Antão (Pacas)</option>
                                <option value="Case Caruaru">Case Caruaru</option>
                                <option value="Case Garanhuns">Case Garanhuns</option>
                                <option value="Case Arcoverde">Case Arcoverde</option>
                                <option value="Case Petrolina">Case Petrolina</option>
                                <option value="Casem Petrolina">Casem Petrolina</option>
                                <option value="Casem Santa Luzia">Casem Santa Luzia</option>
                                <option value="Casem Harmonia">Casem Harmonia</option>
                                <option value="Casem Areias">Casem Areias</option>
                                <option value="Casem Iputinga">Casem Iputinga</option>
                                <option value="Casem Caruaru">Casem Caruaru</option>
                            </select>
                            <button type="button" class="add-unit-btn" onclick="addNewUnit()" title="Adicionar nova unidade">+</button>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin: 20px 0;">
                    <button type="button" class="btn btn-success" onclick="saveUser()">💾 Cadastrar Usuário</button>
                </div>

                <div class="chart-container">
                    <h3>Usuários Cadastrados</h3>
                    <div class="table-container">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>E-mail</th>
                                    <th>WhatsApp</th>
                                    <th>Unidade</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" style="text-align: center; color: #64748b;">Nenhum usuário cadastrado ainda</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Backup Section -->
            <div id="backupSection" class="content-section">
                <div class="section-header">
                    <button class="back-btn" onclick="showMainContent()">← Voltar</button>
                    <h2>🛡️ Sistema de Backup</h2>
                </div>
                
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="lastBackupDate">Nunca</div>
                        <div class="metric-label">Último Backup</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalRecords">0</div>
                        <div class="metric-label">Total de Registros</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="backupSize">0 KB</div>
                        <div class="metric-label">Tamanho dos Dados</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Operações de Backup</h3>
                    <div style="text-align: center; margin: 30px 0;">
                        <button type="button" class="btn btn-success" onclick="createBackup()">💾 Criar Backup</button>
                        <button type="button" class="btn btn-warning" onclick="downloadBackup()">📥 Baixar Backup</button>
                        <button type="button" class="btn btn-info" onclick="scheduleBackup()">⏰ Agendar Backup Automático</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="restoreFile">Restaurar Backup</label>
                        <input type="file" id="restoreFile" accept=".json" onchange="handleRestoreFile(event)">
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Histórico de Backups</h3>
                    <div class="table-container">
                        <table id="backupHistoryTable">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Tipo</th>
                                    <th>Tamanho</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" style="text-align: center; color: #64748b;">Nenhum backup realizado ainda</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ===== VARIÁVEIS GLOBAIS =====
        let currentUser = null;
        let photoCount = 0;
        let activities = JSON.parse(localStorage.getItem('funase_activities') || '[]');
        let invites = JSON.parse(localStorage.getItem('funase_invites') || '[]');
        let users = JSON.parse(localStorage.getItem('funase_users') || '[]');
        let populationData = JSON.parse(localStorage.getItem('funase_population') || '[]');
        let backupHistory = JSON.parse(localStorage.getItem('funase_backups') || '[]');

        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', function() {
            checkRememberedLogin();
            updateDashboard();
            loadUsers();
            loadPopulationHistory();
            loadBackupHistory();
            loadCustomUnits(); // Carregar unidades personalizadas
        });

        // ===== FUNÇÕES DE LOGIN =====
        function checkRememberedLogin() {
            const rememberMe = localStorage.getItem('funase_remember');
            if (rememberMe === 'true') {
                const credentials = JSON.parse(localStorage.getItem('funase_credentials') || '{}');
                document.getElementById('email').value = credentials.email;
                document.getElementById('password').value = credentials.password;
                document.getElementById('rememberMe').checked = true;
                
                currentUser = { email: credentials.email, name: credentials.email.split('@')[0] };
                showMainContent();
            }
        }

        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            if (!email || !password) {
                showError('Por favor, preencha todos os campos.');
                return;
            }
            
            if (!email.includes('@funase.pe.gov.br')) {
                showError('Use apenas e-mails institucionais @funase.pe.gov.br');
                return;
            }
            
            if (password === 'funase2024' || password === '123456') {
                currentUser = { email: email, name: email.split('@')[0] };
                
                if (rememberMe) {
                    localStorage.setItem('funase_credentials', JSON.stringify({ email, password }));
                    localStorage.setItem('funase_remember', 'true');
                } else {
                    localStorage.removeItem('funase_credentials');
                    localStorage.removeItem('funase_remember');
                }
                
                showSuccess('Login realizado com sucesso!');
                setTimeout(showMainContent, 1000);
            } else {
                showError('Senha incorreta. Tente: funase2024');
            }
        }

        function handleLogout() {
            currentUser = null;
            
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            
            const rememberMe = localStorage.getItem('funase_remember');
            if (rememberMe !== 'true') {
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                document.getElementById('rememberMe').checked = false;
            }
        }

        function forgotPassword() {
            alert('📧 Para recuperar sua senha, entre em contato com o administrador do sistema ou envie um e-mail para suporte@funase.pe.gov.br');
        }

        function showMainContent() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            // Ocultar todas as seções de conteúdo
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.style.display = 'none');
            
            // Mostrar apenas os cards principais
            const welcomeSection = document.getElementById('mainCards');
            if (welcomeSection) {
                welcomeSection.style.display = 'block';
            }
            
            // Capitalizar nome do usuário
            const userName = currentUser.name.charAt(0).toUpperCase() + currentUser.name.slice(1);
            document.getElementById('userWelcome').textContent = `Bem-vindo, ${userName}!`;
        }

        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('loginSuccess').style.display = 'none';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('loginSuccess');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            document.getElementById('loginError').style.display = 'none';
        }

        // ===== NAVEGAÇÃO =====
        function showSection(sectionName) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.style.display = 'none');
            
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';
                
                // Se for a seção de formulário, gerar número automático
                if (sectionName === 'form') {
                    initializeActivityNumber();
                }
            }
        }

        // Gerar número automático da atividade
        function generateActivityNumber() {
            const existingActivities = JSON.parse(localStorage.getItem('activities') || '[]');
            const nextNumber = existingActivities.length + 1;
            return nextNumber.toString().padStart(3, '0'); // 001, 002, 003...
        }

        // Inicializar número da atividade ao carregar a seção
        function initializeActivityNumber() {
            const numeroField = document.getElementById('numeroAtividade');
            if (numeroField) {
                numeroField.value = generateActivityNumber();
            }
        }

        // ===== FUNÇÕES DO FORMULÁRIO DE ATIVIDADE =====
        
        // Promotores (até 10)
        function addPromoter() {
            const container = document.getElementById('promoterContainer');
            const currentCount = container.children.length;
            
            if (currentCount >= 10) {
                alert('Máximo de 10 promotores permitido.');
                return;
            }
            
            const newPromoter = document.createElement('div');
            newPromoter.className = 'promoter-input';
            newPromoter.innerHTML = `
                <div class="input-row">
                    <input type="text" placeholder="Nome de quem promoveu a atividade">
                    <div class="button-group">
                        <button type="button" class="btn btn-danger" onclick="removePromoter(this)" title="Remover">Remover</button>
                        <button type="button" class="action-btn star-btn" onclick="favoritePromoter(this)" title="Favoritar">⭐</button>
                    </div>
                </div>
            `;
            container.appendChild(newPromoter);
        }

        function removePromoter(button) {
            button.closest('.promoter-input').remove();
        }

        function favoritePromoter(button) {
            button.classList.toggle('favorited');
        }

        // Participantes (até 10)
        function addParticipant() {
            const container = document.getElementById('participantsContainer');
            const currentCount = container.children.length;
            
            if (currentCount >= 10) {
                alert('Máximo de 10 participantes permitido.');
                return;
            }
            
            const newParticipant = document.createElement('div');
            newParticipant.className = 'participant-input';
            newParticipant.innerHTML = `
                <div class="input-row">
                    <input type="text" placeholder="Nome do jovem participante">
                    <div class="button-group">
                        <button type="button" class="btn btn-danger" onclick="removeParticipant(this)" title="Remover">Remover</button>
                        <button type="button" class="action-btn star-btn" onclick="favoriteParticipant(this)" title="Favoritar">⭐</button>
                    </div>
                </div>
            `;
            container.appendChild(newParticipant);
        }

        function removeParticipant(button) {
            button.closest('.participant-input').remove();
        }

        function favoriteParticipant(button) {
            button.classList.toggle('favorited');
        }

        // Equipe (até 10)
        function addTeamMember() {
            const container = document.getElementById('teamContainer');
            const currentCount = container.children.length;
            
            if (currentCount >= 10) {
                alert('Máximo de 10 membros da equipe permitido.');
                return;
            }
            
            const newMember = document.createElement('div');
            newMember.className = 'team-member';
            newMember.innerHTML = `
                <div class="input-row">
                    <input type="text" placeholder="Nome do membro da equipe">
                    <input type="text" placeholder="Função/Cargo">
                    <div class="button-group">
                        <button type="button" class="btn btn-danger" onclick="removeTeamMember(this)" title="Remover">Remover</button>
                        <button type="button" class="action-btn star-btn" onclick="favoriteTeamMember(this)" title="Favoritar">⭐</button>
                    </div>
                </div>
            `;
            container.appendChild(newMember);
        }

        function removeTeamMember(button) {
            button.closest('.team-member').remove();
        }

        function favoriteTeamMember(button) {
            button.classList.toggle('favorited');
        }

        // Upload de fotos (até 10)
        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            const container = document.getElementById('photoContainer');
            const currentPhotos = container.querySelectorAll('.photo-preview').length;
            
            if (currentPhotos + files.length > 10) {
                alert('Máximo de 10 fotos permitido.');
                return;
            }
            
            files.forEach(file => {
                if (photoCount >= 10) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoDiv = document.createElement('div');
                    photoDiv.className = 'photo-preview';
                    photoDiv.innerHTML = `
                        <img src="${e.target.result}" alt="Foto da atividade">
                        <button class="photo-remove" onclick="removePhoto(this)">×</button>
                    `;
                    
                    // Inserir antes do botão de upload
                    const uploadBtn = container.querySelector('.photo-upload-btn');
                    container.insertBefore(photoDiv, uploadBtn);
                    
                    photoCount++;
                    updatePhotoCount();
                };
                reader.readAsDataURL(file);
            });
            
            // Limpar input
            event.target.value = '';
        }

        function removePhoto(button) {
            button.closest('.photo-preview').remove();
            photoCount--;
            updatePhotoCount();
        }

        function updatePhotoCount() {
            document.getElementById('photoCount').textContent = `${photoCount}/10 fotos`;
        }

        // Ações do formulário
        function saveActivity() {
            const activityData = {
                id: Date.now(),
                number: document.getElementById('activityNumber').value,
                name: document.getElementById('activityName').value,
                date: document.getElementById('activityDate').value,
                time: document.getElementById('activityTime').value,
                location: document.getElementById('activityLocation').value,
                type: document.getElementById('activityTypeSelect').value,
                description: document.getElementById('activityDescription').value,
                promoters: getInputValues('promoterContainer'),
                participants: getInputValues('participantsContainer'),
                team: getTeamValues(),
                photos: photoCount,
                createdAt: new Date().toISOString()
            };
            
            activities.push(activityData);
            localStorage.setItem('funase_activities', JSON.stringify(activities));
            
            alert('✅ Atividade salva com sucesso!');
            updateDashboard();
            loadActivityHistory();
        }

        function duplicateActivity() {
            // Implementar duplicação de atividade
            alert('📋 Funcionalidade de duplicar atividade será implementada.');
        }

        function addReport() {
            // Implementar adição de relatório
            alert('📝 Funcionalidade de acrescentar relatório será implementada.');
        }

        function newActivity() {
            // Limpar todos os campos
            document.getElementById('activityNumber').value = '';
            document.getElementById('activityName').value = '';
            document.getElementById('activityDate').value = '';
            document.getElementById('activityTime').value = '';
            document.getElementById('activityLocation').value = '';
            document.getElementById('activityDescription').value = '';
            
            // Resetar containers
            document.getElementById('promoterContainer').innerHTML = `
                <div class="promoter-input">
                    <div class="input-row">
                        <input type="text" placeholder="Nome de quem promoveu a atividade">
                        <div class="button-group">
                            <button type="button" class="action-btn add-btn" onclick="addPromoter()" title="Adicionar promotor">+</button>
                            <button type="button" class="action-btn star-btn" onclick="favoritePromoter(this)" title="Favoritar">⭐</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('participantsContainer').innerHTML = `
                <div class="participant-input">
                    <div class="input-row">
                        <input type="text" placeholder="Nome do jovem participante">
                        <div class="button-group">
                            <button type="button" class="action-btn add-btn" onclick="addParticipant()" title="Adicionar participante">+</button>
                            <button type="button" class="action-btn star-btn" onclick="favoriteParticipant(this)" title="Favoritar">⭐</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('teamContainer').innerHTML = `
                <div class="team-member">
                    <div class="input-row">
                        <input type="text" placeholder="Nome do membro da equipe">
                        <input type="text" placeholder="Função/Cargo">
                        <div class="button-group">
                            <button type="button" class="action-btn add-btn" onclick="addTeamMember()" title="Adicionar membro">+</button>
                            <button type="button" class="action-btn star-btn" onclick="favoriteTeamMember(this)" title="Favoritar">⭐</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Limpar fotos
            document.getElementById('photoContainer').innerHTML = `
                <div class="photo-upload-btn" onclick="document.getElementById('photoInput').click()">
                    <span style="font-size: 2rem;">📷</span>
                    <span>Adicionar Fotos</span>
                </div>
            `;
            photoCount = 0;
            updatePhotoCount();
            
            alert('➕ Nova atividade iniciada! Preencha os dados.');
        }

        // Funções auxiliares
        function getInputValues(containerId) {
            const container = document.getElementById(containerId);
            const inputs = container.querySelectorAll('input[type="text"]');
            return Array.from(inputs).map(input => input.value).filter(value => value.trim() !== '');
        }

        function getTeamValues() {
            const container = document.getElementById('teamContainer');
            const members = container.querySelectorAll('.team-member');
            return Array.from(members).map(member => {
                const inputs = member.querySelectorAll('input[type="text"]');
                return {
                    name: inputs[0]?.value || '',
                    role: inputs[1]?.value || ''
                };
            }).filter(member => member.name.trim() !== '');
        }

        // ===== FUNÇÕES DE CONVITES =====
        
        function favoriteEventName(button) {
            button.classList.toggle('favorited');
        }

        function favoriteEventLocation(button) {
            button.classList.toggle('favorited');
        }

        function addLocationLink() {
            const linkInput = document.getElementById('locationLink');
            linkInput.style.display = linkInput.style.display === 'none' ? 'block' : 'none';
        }

        function handleConviteImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const container = document.getElementById('conviteImageContainer');
                container.innerHTML = `
                    <div class="photo-preview">
                        <img src="${e.target.result}" alt="Imagem do convite">
                        <button class="photo-remove" onclick="removeConviteImage()">×</button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function removeConviteImage() {
            document.getElementById('conviteImageContainer').innerHTML = `
                <div class="photo-upload-btn" onclick="document.getElementById('conviteImageInput').click()">
                    <span style="font-size: 2rem;">🖼️</span>
                    <span>Adicionar Imagem</span>
                </div>
            `;
        }

        // Dropdown de unidades
        function toggleUnitsDropdown() {
            const dropdown = document.getElementById('unitsDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function toggleAllUnits(checkbox) {
            const unitCheckboxes = document.querySelectorAll('input[name="unidade"]');
            unitCheckboxes.forEach(cb => cb.checked = checkbox.checked);
            updateSelectedUnits();
        }

        function updateSelectedUnits() {
            const selectedUnits = Array.from(document.querySelectorAll('input[name="unidade"]:checked'))
                .map(cb => cb.value);
            
            const text = selectedUnits.length === 0 ? 'Selecione as unidades...' :
                        selectedUnits.length === 1 ? selectedUnits[0] :
                        `${selectedUnits.length} unidades selecionadas`;
            
            document.getElementById('selectedUnitsText').textContent = text;
        }

        function saveInvite() {
            const inviteData = {
                id: Date.now(),
                name: document.getElementById('eventName').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                location: document.getElementById('eventLocation').value,
                locationLink: document.getElementById('locationLink').value,
                description: document.getElementById('eventDescription').value,
                vacancies: document.getElementById('eventVacancies').value,
                units: Array.from(document.querySelectorAll('input[name="unidade"]:checked')).map(cb => cb.value),
                createdAt: new Date().toISOString(),
                published: false
            };
            
            invites.push(inviteData);
            localStorage.setItem('funase_invites', JSON.stringify(invites));
            
            alert('✅ Convite salvo com sucesso!');
            updateDashboard();
        }

        function publishInvite() {
            // Simular publicação com notificações
            const selectedUnits = Array.from(document.querySelectorAll('input[name="unidade"]:checked')).map(cb => cb.value);
            
            if (selectedUnits.length === 0) {
                alert('❌ Selecione pelo menos uma unidade para publicar o convite.');
                return;
            }
            
            // Filtrar usuários das unidades selecionadas
            const targetUsers = users.filter(user => selectedUnits.includes(user.unit));
            
            if (targetUsers.length === 0) {
                alert('⚠️ Nenhum usuário cadastrado nas unidades selecionadas. Cadastre usuários primeiro.');
                return;
            }
            
            // Simular envio
            alert(`📢 Convite publicado com sucesso!\n\n📧 E-mails enviados: ${targetUsers.length}\n📱 WhatsApp enviados: ${targetUsers.length}\n\nUnidades notificadas:\n${selectedUnits.join('\n')}`);
            
            // Salvar convite como publicado
            saveInvite();
            updateDashboard();
        }

        // ===== FUNÇÕES DO DASHBOARD =====
        
        function updateDashboard() {
            // Atualizar métricas
            document.getElementById('totalActivities').textContent = activities.length;
            document.getElementById('totalInvites').textContent = invites.length;
            
            const publishedInvites = invites.filter(invite => invite.published).length;
            document.getElementById('acceptedInvites').textContent = publishedInvites;
            
            const conversionRate = invites.length > 0 ? ((publishedInvites / invites.length) * 100).toFixed(1) : 0;
            document.getElementById('conversionRate').textContent = conversionRate + '%';
            
            // Calcular participações
            let totalParticipations = 0;
            let uniqueYouths = new Set();
            
            activities.forEach(activity => {
                if (activity.participants) {
                    activity.participants.forEach(participant => {
                        if (participant.trim()) {
                            totalParticipations++;
                            uniqueYouths.add(participant.trim().toLowerCase());
                        }
                    });
                }
            });
            
            document.getElementById('totalParticipations').textContent = totalParticipations;
            document.getElementById('uniqueYouths').textContent = uniqueYouths.size;
            
            // Calcular percentual de participação
            const latestPopulation = getLatestPopulationData();
            if (latestPopulation && latestPopulation.total > 0) {
                const participationPercentage = ((uniqueYouths.size / latestPopulation.total) * 100).toFixed(1);
                document.getElementById('participationPercentage').textContent = participationPercentage + '%';
            } else {
                document.getElementById('participationPercentage').textContent = 'N/A';
            }
            
            // Média de participações por jovem
            const averageParticipation = uniqueYouths.size > 0 ? (totalParticipations / uniqueYouths.size).toFixed(1) : 0;
            document.getElementById('averageParticipation').textContent = averageParticipation;
        }

        function showPopulationData() {
            document.getElementById('populationDataSection').style.display = 'block';
            document.getElementById('populationDate').value = new Date().toISOString().split('T')[0];
        }

        function hidePopulationData() {
            document.getElementById('populationDataSection').style.display = 'none';
        }

        function savePopulationData() {
            const date = document.getElementById('populationDate').value;
            const total = parseInt(document.getElementById('totalYouths').value);
            const notes = document.getElementById('populationNotes').value;
            
            if (!date || !total || total < 1) {
                alert('❌ Preencha todos os campos obrigatórios.');
                return;
            }
            
            const populationEntry = {
                id: Date.now(),
                date: date,
                total: total,
                notes: notes,
                createdAt: new Date().toISOString()
            };
            
            populationData.push(populationEntry);
            localStorage.setItem('funase_population', JSON.stringify(populationData));
            
            alert('✅ Dados populacionais salvos com sucesso!');
            loadPopulationHistory();
            updateDashboard();
            
            // Limpar campos
            document.getElementById('totalYouths').value = '';
            document.getElementById('populationNotes').value = '';
        }

        function loadPopulationHistory() {
            const tbody = document.querySelector('#populationHistoryTable tbody');
            
            if (populationData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #64748b;">Nenhum dado populacional registrado ainda</td></tr>';
                return;
            }
            
            tbody.innerHTML = populationData.map(entry => `
                <tr>
                    <td>${new Date(entry.date).toLocaleDateString('pt-BR')}</td>
                    <td>${entry.total}</td>
                    <td>${entry.notes || '-'}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deletePopulationData(${entry.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function deletePopulationData(id) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                populationData = populationData.filter(entry => entry.id !== id);
                localStorage.setItem('funase_population', JSON.stringify(populationData));
                loadPopulationHistory();
                updateDashboard();
            }
        }

        function getLatestPopulationData() {
            if (populationData.length === 0) return null;
            return populationData.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
        }

        function exportPopulationData() {
            if (populationData.length === 0) {
                alert('❌ Nenhum dado para exportar.');
                return;
            }
            
            const dataStr = JSON.stringify(populationData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `dados_populacionais_funase_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // ===== FUNÇÕES DE CONSULTA INDIVIDUAL =====
        
        let currentYouthData = null; // Armazenar dados do jovem atual
        
        function searchYouthHistory() {
            const youthName = document.getElementById('searchYouth').value.trim();
            const unit = document.getElementById('searchUnit').value;
            
            if (!youthName) {
                alert('❌ Digite o nome do jovem para buscar.');
                return;
            }
            
            // Buscar atividades do jovem
            const youthActivities = activities.filter(activity => {
                if (!activity.participants) return false;
                
                const hasYouth = activity.participants.some(participant => 
                    participant.toLowerCase().includes(youthName.toLowerCase())
                );
                
                if (unit && activity.unit !== unit) return false;
                
                return hasYouth;
            });
            
            // Armazenar dados do jovem atual
            currentYouthData = {
                name: youthName,
                unit: unit,
                activities: youthActivities
            };
            
            // Exibir resultados
            document.getElementById('youthHistoryResult').style.display = 'block';
            document.getElementById('youthName').textContent = `Histórico de: ${youthName}`;
            document.getElementById('totalActivities').textContent = youthActivities.length;
            
            // Mostrar botões de ação
            document.getElementById('generateReportBtn').style.display = 'inline-block';
            document.getElementById('manageCertBtn').style.display = 'inline-block';
            
            // Calcular frequência (simulada)
            const totalPossibleActivities = activities.length;
            const frequency = totalPossibleActivities > 0 ? ((youthActivities.length / totalPossibleActivities) * 100).toFixed(1) : 0;
            document.getElementById('participationFrequency').textContent = frequency + '%';
            
            // Preencher tabela
            const tbody = document.querySelector('#youthActivitiesTable tbody');
            if (youthActivities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b;">Nenhuma atividade encontrada para este jovem</td></tr>';
            } else {
                tbody.innerHTML = youthActivities.map(activity => `
                    <tr>
                        <td>${new Date(activity.date).toLocaleDateString('pt-BR')}</td>
                        <td>${activity.name}</td>
                        <td>${activity.type === 'interna' ? 'Interna' : 'Externa'}</td>
                        <td>${activity.location}</td>
                        <td>${activity.unit || 'N/A'}</td>
                    </tr>
                `).join('');
            }
        }

        function generateYouthReport() {
            if (!currentYouthData) {
                alert('❌ Nenhum jovem selecionado.');
                return;
            }
            
            const reportContent = generateReportHTML(currentYouthData);
            
            // Criar nova janela para impressão
            const printWindow = window.open('', '_blank');
            printWindow.document.write(reportContent);
            printWindow.document.close();
            printWindow.focus();
            
            // Aguardar carregamento e imprimir
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        function generateReportHTML(youthData) {
            const currentDate = new Date().toLocaleDateString('pt-BR');
            const activities = youthData.activities;
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Relatório de Atividades - ${youthData.name}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                        .header { text-align: center; margin-bottom: 40px; }
                        .logo { color: #1e3a8a; font-size: 24px; font-weight: bold; }
                        .title { color: #1e3a8a; font-size: 20px; margin: 20px 0; }
                        .info { background: #f8fafc; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .activity { border-bottom: 1px solid #e2e8f0; padding: 15px 0; }
                        .activity:last-child { border-bottom: none; }
                        .activity-title { font-weight: bold; color: #1e3a8a; }
                        .activity-details { margin-top: 5px; color: #64748b; }
                        .footer { margin-top: 40px; text-align: center; color: #64748b; }
                        @media print { body { margin: 20px; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">🏛️ FUNDAÇÃO DE ATENDIMENTO SOCIOEDUCATIVO - FUNASE</div>
                        <div class="title">RELATÓRIO DE ATIVIDADES SOCIOEDUCATIVAS</div>
                    </div>
                    
                    <div class="info">
                        <strong>Nome do Jovem:</strong> ${youthData.name}<br>
                        <strong>Unidade:</strong> ${youthData.unit || 'Não especificada'}<br>
                        <strong>Data do Relatório:</strong> ${currentDate}<br>
                        <strong>Total de Atividades:</strong> ${activities.length}
                    </div>
                    
                    <h3 style="color: #1e3a8a;">HISTÓRICO DE PARTICIPAÇÃO EM ATIVIDADES</h3>
                    
                    <p>O presente relatório tem por finalidade apresentar o histórico de participação do jovem em atividades socioeducativas, culturais, esportivas e educacionais desenvolvidas durante o período de atendimento na FUNASE, demonstrando o engajamento e evolução no processo de ressocialização.</p>
                    
                    ${activities.length > 0 ? `
                        <div style="margin: 30px 0;">
                            ${activities.map((activity, index) => `
                                <div class="activity">
                                    <div class="activity-title">${index + 1}. ${activity.name}</div>
                                    <div class="activity-details">
                                        <strong>Data:</strong> ${new Date(activity.date).toLocaleDateString('pt-BR')}<br>
                                        <strong>Tipo:</strong> ${activity.type === 'interna' ? 'Atividade Interna' : 'Atividade Externa'}<br>
                                        <strong>Local:</strong> ${activity.location}<br>
                                        <strong>Horário:</strong> ${activity.time}<br>
                                        ${activity.description ? `<strong>Descrição:</strong> ${activity.description}<br>` : ''}
                                        ${activity.promoters && activity.promoters.length > 0 ? `<strong>Promovido por:</strong> ${activity.promoters.join(', ')}<br>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <p style="text-align: center; color: #64748b; margin: 40px 0;">
                            Nenhuma atividade registrada para este jovem no período consultado.
                        </p>
                    `}
                    
                    <div class="footer">
                        <p><strong>CONSIDERAÇÕES FINAIS</strong></p>
                        <p>Este relatório demonstra a participação ativa do jovem nas atividades propostas pela unidade, evidenciando seu comprometimento com o processo socioeducativo e contribuindo para sua formação integral e reinserção social.</p>
                        <br>
                        <p>Relatório gerado automaticamente pelo Sistema de Atividades FUNASE em ${currentDate}</p>
                    </div>
                </body>
                </html>
            `;
        }

        function manageCertificates() {
            if (!currentYouthData) {
                alert('❌ Nenhum jovem selecionado.');
                return;
            }
            
            // Preencher dropdown de atividades
            const select = document.getElementById('certificateActivity');
            select.innerHTML = '<option value="">Selecione uma atividade...</option>';
            
            currentYouthData.activities.forEach(activity => {
                const option = document.createElement('option');
                option.value = activity.id;
                option.textContent = `${activity.name} - ${new Date(activity.date).toLocaleDateString('pt-BR')}`;
                select.appendChild(option);
            });
            
            document.getElementById('certificatesModal').style.display = 'flex';
        }

        function closeCertificatesModal() {
            document.getElementById('certificatesModal').style.display = 'none';
            document.getElementById('certificateFile').value = '';
            document.getElementById('certificateNotes').value = '';
            document.getElementById('certificatePreview').innerHTML = '';
        }

        function previewCertificate(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('certificatePreview');
            
            if (file) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 200px; border-radius: 8px;">`;
                    };
                    reader.readAsDataURL(file);
                } else if (file.type === 'application/pdf') {
                    preview.innerHTML = `<div style="padding: 10px; background: #f8fafc; border-radius: 8px; text-align: center;">📄 ${file.name}</div>`;
                }
            } else {
                preview.innerHTML = '';
            }
        }

        function saveCertificate() {
            const activityId = document.getElementById('certificateActivity').value;
            const file = document.getElementById('certificateFile').files[0];
            const notes = document.getElementById('certificateNotes').value;
            
            if (!activityId || !file) {
                alert('❌ Selecione uma atividade e faça upload do certificado.');
                return;
            }
            
            // Simular salvamento (em implementação real, seria enviado para servidor)
            const certificateData = {
                id: Date.now(),
                youthName: currentYouthData.name,
                activityId: activityId,
                fileName: file.name,
                fileType: file.type,
                notes: notes,
                uploadDate: new Date().toISOString()
            };
            
            // Salvar no localStorage (simulação)
            let certificates = JSON.parse(localStorage.getItem('funase_certificates') || '[]');
            certificates.push(certificateData);
            localStorage.setItem('funase_certificates', JSON.stringify(certificates));
            
            alert('✅ Certificado salvo com sucesso!');
            closeCertificatesModal();
        }

        function exportYouthReport() {
            if (!currentYouthData) {
                alert('❌ Nenhum jovem selecionado.');
                return;
            }
            generateYouthReport();
        }

        // ===== FUNÇÕES DE USUÁRIOS =====
        
        function addNewUnit() {
            const newUnitName = prompt('Digite o nome da nova unidade:');
            
            if (!newUnitName) {
                return; // Usuário cancelou
            }
            
            if (newUnitName.trim() === '') {
                alert('❌ Nome da unidade não pode estar vazio.');
                return;
            }
            
            const select = document.getElementById('userUnit');
            
            // Verificar se a unidade já existe
            const existingOptions = Array.from(select.options).map(option => option.value.toLowerCase());
            if (existingOptions.includes(newUnitName.trim().toLowerCase())) {
                alert('❌ Esta unidade já existe na lista.');
                return;
            }
            
            // Adicionar nova opção ao select
            const newOption = document.createElement('option');
            newOption.value = newUnitName.trim();
            newOption.textContent = newUnitName.trim();
            select.appendChild(newOption);
            
            // Selecionar a nova unidade
            select.value = newUnitName.trim();
            
            // Salvar unidades personalizadas no localStorage
            let customUnits = JSON.parse(localStorage.getItem('funase_custom_units') || '[]');
            if (!customUnits.includes(newUnitName.trim())) {
                customUnits.push(newUnitName.trim());
                localStorage.setItem('funase_custom_units', JSON.stringify(customUnits));
            }
            
            alert('✅ Nova unidade adicionada com sucesso!');
        }

        function loadCustomUnits() {
            const customUnits = JSON.parse(localStorage.getItem('funase_custom_units') || '[]');
            const select = document.getElementById('userUnit');
            
            // Adicionar unidades personalizadas ao select
            customUnits.forEach(unitName => {
                const existingOptions = Array.from(select.options).map(option => option.value);
                if (!existingOptions.includes(unitName)) {
                    const newOption = document.createElement('option');
                    newOption.value = unitName;
                    newOption.textContent = unitName;
                    select.appendChild(newOption);
                }
            });
        }
        
        function saveUser() {
            const userData = {
                id: Date.now(),
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                whatsapp: document.getElementById('userWhatsapp').value,
                unit: document.getElementById('userUnit').value,
                createdAt: new Date().toISOString()
            };
            
            // Validações
            if (!userData.name || !userData.email || !userData.whatsapp || !userData.unit) {
                alert('❌ Preencha todos os campos.');
                return;
            }
            
            if (!userData.email.includes('@funase.pe.gov.br')) {
                alert('❌ Use apenas e-mails institucionais @funase.pe.gov.br');
                return;
            }
            
            // Verificar duplicatas
            if (users.some(user => user.email === userData.email)) {
                alert('❌ Este e-mail já está cadastrado.');
                return;
            }
            
            users.push(userData);
            localStorage.setItem('funase_users', JSON.stringify(users));
            
            alert('✅ Usuário cadastrado com sucesso!');
            loadUsers();
            
            // Limpar campos
            document.getElementById('userName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userWhatsapp').value = '';
            document.getElementById('userUnit').value = '';
        }

        function loadUsers() {
            const tbody = document.querySelector('#usersTable tbody');
            
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b;">Nenhum usuário cadastrado ainda</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.whatsapp}</td>
                    <td>${user.unit}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteUser(${user.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteUser(id) {
            if (confirm('Tem certeza que deseja excluir este usuário?')) {
                users = users.filter(user => user.id !== id);
                localStorage.setItem('funase_users', JSON.stringify(users));
                loadUsers();
            }
        }

        // ===== FUNÇÕES DE BACKUP =====
        
        function createBackup() {
            const backupData = {
                activities: activities,
                invites: invites,
                users: users,
                populationData: populationData,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            const backupEntry = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                type: 'Manual',
                size: JSON.stringify(backupData).length,
                status: 'Concluído'
            };
            
            backupHistory.push(backupEntry);
            localStorage.setItem('funase_backups', JSON.stringify(backupHistory));
            localStorage.setItem('funase_last_backup', JSON.stringify(backupData));
            
            alert('✅ Backup criado com sucesso!');
            loadBackupHistory();
            updateBackupStats();
        }

        function downloadBackup() {
            const lastBackup = localStorage.getItem('funase_last_backup');
            if (!lastBackup) {
                alert('❌ Nenhum backup disponível. Crie um backup primeiro.');
                return;
            }
            
            const dataBlob = new Blob([lastBackup], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup_funase_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function scheduleBackup() {
            alert('⏰ Funcionalidade de backup automático será implementada em breve.');
        }

        function handleRestoreFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (confirm('⚠️ Isso irá substituir todos os dados atuais. Continuar?')) {
                        activities = backupData.activities || [];
                        invites = backupData.invites || [];
                        users = backupData.users || [];
                        populationData = backupData.populationData || [];
                        
                        localStorage.setItem('funase_activities', JSON.stringify(activities));
                        localStorage.setItem('funase_invites', JSON.stringify(invites));
                        localStorage.setItem('funase_users', JSON.stringify(users));
                        localStorage.setItem('funase_population', JSON.stringify(populationData));
                        
                        alert('✅ Backup restaurado com sucesso!');
                        location.reload();
                    }
                } catch (error) {
                    alert('❌ Arquivo de backup inválido.');
                }
            };
            reader.readAsText(file);
        }

        function loadBackupHistory() {
            const tbody = document.querySelector('#backupHistoryTable tbody');
            
            if (backupHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b;">Nenhum backup realizado ainda</td></tr>';
                return;
            }
            
            tbody.innerHTML = backupHistory.map(backup => `
                <tr>
                    <td>${new Date(backup.timestamp).toLocaleString('pt-BR')}</td>
                    <td>${backup.type}</td>
                    <td>${(backup.size / 1024).toFixed(1)} KB</td>
                    <td>${backup.status}</td>
                    <td>
                        <button class="btn btn-primary" onclick="downloadBackup()">Baixar</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateBackupStats() {
            const lastBackup = backupHistory.length > 0 ? 
                new Date(backupHistory[backupHistory.length - 1].timestamp).toLocaleDateString('pt-BR') : 'Nunca';
            
            const totalRecords = activities.length + invites.length + users.length + populationData.length;
            const totalSize = JSON.stringify({activities, invites, users, populationData}).length;
            
            document.getElementById('lastBackupDate').textContent = lastBackup;
            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('backupSize').textContent = (totalSize / 1024).toFixed(1) + ' KB';
        }

        // ===== HISTÓRICO DE ATIVIDADES =====
        
        function loadActivityHistory() {
            const tbody = document.querySelector('#activityHistoryTable tbody');
            
            if (activities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #64748b;">Nenhuma atividade registrada ainda</td></tr>';
                return;
            }
            
            tbody.innerHTML = activities.map(activity => `
                <tr>
                    <td>${activity.number || 'N/A'}</td>
                    <td>${activity.name}</td>
                    <td>${new Date(activity.date).toLocaleDateString('pt-BR')}</td>
                    <td>${activity.type === 'interna' ? 'Interna' : 'Externa'}</td>
                    <td>${activity.participants ? activity.participants.length : 0}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editActivity(${activity.id})">Editar</button>
                        <button class="btn btn-info" onclick="addActivityReport(${activity.id})">Relatório</button>
                    </td>
                </tr>
            `).join('');
        }

        function editActivity(id) {
            alert(`✏️ Funcionalidade de edição da atividade ${id} será implementada.`);
        }

        function addActivityReport(id) {
            alert(`📝 Funcionalidade de relatório da atividade ${id} será implementada.`);
        }

        // Fechar dropdowns ao clicar fora
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.custom-dropdown')) {
                document.getElementById('unitsDropdown').style.display = 'none';
            }
        });

        // Inicializar dados ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            loadActivityHistory();
            updateBackupStats();
        });
    </script>
</body>
</html>

